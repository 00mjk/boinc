<?php

// 

require_once('discussion_forums.features.inc');

/**
 * Make some changes to configurations after the feature has been enabled
 */
function discussion_forums_enable() {
  // Check that the forum access module has its internal role set up and that
  // it has been renamed from "Forum Moderator," which is ridiculous
  if (!$rid = forum_access_query_moderator_rid()) {
    module_load_include('inc', 'forum_access', 'forum_access.admin');
    $rid = _forum_access_create_moderator_rid();
  }
  $ret = array();
  $roles = user_roles();
  if ($rid AND isset($roles[$rid])) {
    $role_name = $roles[$rid];
    if ($role_name == 'Forum Moderator') {
      $ret[] = db_query("UPDATE {role} SET name = '%s' WHERE rid = %d",
        t('forum control (system use only)'), $rid);
    }
  }
}

function discussion_forums_menu_alter(&$items) {
  // Change the forum menu item to use the path: community/forum
  $items['community'] = $items['forum'];
  $items['community']['title'] = t('Community');
  $items['community']['type'] = MENU_NORMAL_ITEM;
  $items['community']['menu_name'] = 'primary-links';
  $items['community/forum'] = $items['community'];
  $items['community/forum']['title'] = t('Message boards');
  unset($items['forum']);
}
